{% extends 'base.html' %}

{% block title %}Dashboard{% endblock %}
{% block page_header %}Dashboard{% endblock %}
{% block breadcrumb_active %}Overview{% endblock %}

{% block content %}
<div class="container-fluid px-3 px-md-4 pb-5">

  <!-- ── Stat cards ─────────────────────────────── -->
  <div class="row mb-4">

    <!-- Users -->
    <div class="col-12 col-sm-6 col-xl-3 mb-3">
      <div class="card stat-card h-100">
        <div class="card-body d-flex align-items-center" style="gap:16px; padding:20px;">
          <div class="stat-icon indigo">
            <i class="fas fa-users"></i>
          </div>
          <div>
            <p class="mb-1" style="font-size:11px;font-weight:600;letter-spacing:.6px;text-transform:uppercase;color:#8b949e;">Total Users</p>
            <h2 class="mb-0" style="font-size:2rem;font-weight:700;color:#e6edf3;line-height:1;">{{ total_users }}</h2>
          </div>
        </div>
      </div>
    </div>

    <!-- Devices -->
    <div class="col-12 col-sm-6 col-xl-3 mb-3">
      <div class="card stat-card green h-100">
        <div class="card-body d-flex align-items-center" style="gap:16px; padding:20px;">
          <div class="stat-icon green">
            <i class="fas fa-mobile-alt"></i>
          </div>
          <div>
            <p class="mb-1" style="font-size:11px;font-weight:600;letter-spacing:.6px;text-transform:uppercase;color:#8b949e;">Total Devices</p>
            <h2 class="mb-0" style="font-size:2rem;font-weight:700;color:#e6edf3;line-height:1;">{{ total_devices }}</h2>
          </div>
        </div>
      </div>
    </div>

    <!--
    TODO: Add project-specific stat cards here.
    Example:
    <div class="col-12 col-sm-6 col-xl-3 mb-3">
      <div class="card stat-card yellow h-100">
        <div class="card-body d-flex align-items-center" style="gap:16px; padding:20px;">
          <div class="stat-icon yellow"><i class="fas fa-box"></i></div>
          <div>
            <p class="mb-1" style="font-size:11px;font-weight:600;letter-spacing:.6px;text-transform:uppercase;color:#8b949e;">Total Items</p>
            <h2 class="mb-0" style="font-size:2rem;font-weight:700;color:#e6edf3;line-height:1;">{{ total_items }}</h2>
          </div>
        </div>
      </div>
    </div>
    -->

  </div>

  <!-- ── Chart + Quick links ─────────────────────── -->
  <div class="row">

    <!-- Chart -->
    <div class="col-12 col-xl-8 mb-4">
      <div class="card h-100">
        <div class="card-header d-flex align-items-center justify-content-between px-4 py-3">
          <div>
            <h6 class="mb-0" style="font-weight:600;color:#e6edf3;">Device Registrations</h6>
            <small style="color:#8b949e;">Last 15 days</small>
          </div>
          <span style="width:10px;height:10px;border-radius:50%;background:#6366f1;display:inline-block;"></span>
        </div>
        <div class="card-body px-4 pb-4 pt-3">
          <canvas id="deviceTrendChart" height="110"></canvas>
        </div>
      </div>
    </div>

    <!-- Quick Actions -->
    <div class="col-12 col-xl-4 mb-4">
      <div class="card h-100">
        <div class="card-header px-4 py-3">
          <h6 class="mb-0" style="font-weight:600;color:#e6edf3;">Quick Actions</h6>
        </div>
        <div class="card-body px-3 py-3">
          <a href="{% url 'addUser' %}" class="d-flex align-items-center p-3 mb-2 text-decoration-none quick-action-item" style="border-radius:8px; border:1px solid #30363d; gap:12px;">
            <span class="stat-icon indigo" style="width:36px;height:36px;border-radius:8px;font-size:13px;"><i class="fas fa-user-plus"></i></span>
            <div>
              <p class="mb-0" style="font-size:13px;font-weight:600;color:#e6edf3;">Add User</p>
              <small style="color:#8b949e;">Create a new admin user</small>
            </div>
            <i class="fas fa-chevron-right ml-auto" style="color:#484f58; font-size:11px;"></i>
          </a>
          <a href="{% url 'userList' %}" class="d-flex align-items-center p-3 text-decoration-none quick-action-item" style="border-radius:8px; border:1px solid #30363d; gap:12px;">
            <span class="stat-icon green" style="width:36px;height:36px;border-radius:8px;font-size:13px;"><i class="fas fa-list"></i></span>
            <div>
              <p class="mb-0" style="font-size:13px;font-weight:600;color:#e6edf3;">View Users</p>
              <small style="color:#8b949e;">Browse all users</small>
            </div>
            <i class="fas fa-chevron-right ml-auto" style="color:#484f58; font-size:11px;"></i>
          </a>
          <!-- TODO: Add project-specific quick actions here -->
        </div>
      </div>
    </div>

  </div>
</div>

<style>
  .quick-action-item { transition: background .15s; }
  .quick-action-item:hover { background: rgba(99,102,241,0.07) !important; }
</style>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const ctx = document.getElementById('deviceTrendChart').getContext('2d');
  new Chart(ctx, {
    type: 'line',
    data: {
      labels: {{ chart_labels|safe }},
      datasets: [{
        label: 'Devices',
        data: {{ device_counts|safe }},
        borderColor: '#6366f1',
        backgroundColor: 'rgba(99,102,241,0.08)',
        fill: true,
        tension: 0.45,
        pointRadius: 4,
        pointBackgroundColor: '#6366f1',
        pointBorderColor: '#1c2128',
        pointBorderWidth: 2,
        borderWidth: 2,
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { display: false },
        tooltip: {
          backgroundColor: '#1c2128',
          borderColor: '#30363d',
          borderWidth: 1,
          titleColor: '#e6edf3',
          bodyColor: '#8b949e',
          padding: 10,
          cornerRadius: 8,
        }
      },
      scales: {
        x: {
          grid: { color: '#1e2530' },
          ticks: { color: '#8b949e', font: { size: 11 } }
        },
        y: {
          beginAtZero: true,
          grid: { color: '#1e2530' },
          ticks: { color: '#8b949e', font: { size: 11 }, stepSize: 1, precision: 0 }
        }
      }
    }
  });
</script>
{% endblock %}
